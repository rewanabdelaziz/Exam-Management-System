<div class=" min-vh-100  d-flex  bg-light py-3 ">
  <div class=" d-flex flex-column">

    <div class="back text-start mb-1 p-1" routerLink="/doctorDashboard/exams">
      <i class="fa-solid fa-arrow-left"></i> <span class="ms-2">Back to exams</span>
    </div>

    <div class="mb-4 text-start">
      <h3 class="fw-bold text-dark mb-1">create new exam</h3>
      <p class="text-muted small">configure your exam setting</p>
    </div>


    <div class="form-box d-flex flex-column justify-content-center align-items-center p-5 rounded ">

       <div class="w-100">
            <form class="w-100" [formGroup]="newExamForm">
          
              <!-- Exam Title -->
              <div class="mb-4">
                <label class="form-label fw-semibold">Exam Title</label>
                <input
                  type="text"
                  class="form-control p-3"
                  placeholder="e.g., Introduction to JavaScript"
                  formControlName="title"
                />
              </div>
          
              <!-- Description -->
              <div class="mb-4">
                <label class="form-label fw-semibold">Description</label>
                <textarea
                  class="form-control p-3"
                  rows="4"
                  placeholder="Describe what this exam covers..."
                  formControlName="description"
                ></textarea>
              </div>
          
              <!-- Row: Duration / Total Questions / Passing Score -->
              <div class="row mb-4">
                <div class="col-md-4">
                  <label class="form-label fw-semibold">Duration (minutes)</label>
                  <input
                    type="number"
                    class="form-control p-3"
                    placeholder="30"
                    formControlName="duration"
                    min = "1"
                  />

                  @if (newExamForm.get('duration')?.errors?.['min'] && newExamForm.get('duration')?.touched) {
                      <div class="text-danger small mt-1">
                        invalid time
                      </div>
                    }

                </div>

                <div class="col-md-4">
                  <label class="form-label fw-semibold">Passing Score (%)</label>
                  <input
                    type="number"
                    class="form-control p-3"
                    placeholder="75"
                    formControlName="passingScore"
                    min="1"
                    max="100"
                  />
                    @if (newExamForm.get('passingScore')?.errors?.['max'] && newExamForm.get('passingScore')?.touched) {
                      <div class="text-danger small mt-1">
                        <i class="fa-solid fa-circle-exclamation me-1"></i>
                        The score cannot exceed 100%.
                      </div>
                    }
                    @if (newExamForm.get('passingScore')?.errors?.['min'] && newExamForm.get('passingScore')?.touched) {
                      <div class="text-danger small mt-1">
                        The score must be at least 1%.
                      </div>
                    }
                </div>
          
                <div class="col-md-4">
                  <label class="form-label fw-semibold">Total Questions</label>
                  <input
                    type="number"
                    class="form-control p-3"
                    placeholder="0"
                    readonly
                    formControlName="totalQuestions"
                  />
                </div>

                
          
                
              </div>
          
            <!-- questions -->
            <div formArrayName="questions" class="mt-5 w-100">
              @for (q of questions.controls; track $index ; let qIndex = $index) {
                <div [formGroupName]="$index" class="card mb-4 p-4 border-primary shadow-sm position-relative">
                  
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="text-primary mb-0">Question {{ $index + 1 }}</h5>
                    <button 
                      type="button" 
                      class="btn btn-outline-danger btn-sm border-0" 
                      (click)="removeQuestion($index)"
                      title="Remove Question">
                      <i class="fa-solid fa-trash-can"></i>
                    </button>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Question Text</label>
                    <input type="text" formControlName="questionText" class="form-control" placeholder="Enter the question">
                  </div>

                  <div formArrayName="options" class="row">
                      @for (opt of [0,1,2,3]; track opt; let optIndex = $index) {
                        <div class="col-md-6 mb-2">
                          <div class="input-group">
                            <span class="input-group-text"
                              [class.bg-success]="isCorrectOption(qIndex, optIndex)"
                              [class.text-white]="isCorrectOption(qIndex, optIndex)">
                              {{ ['A', 'B', 'C', 'D'][optIndex] }}
                            </span>
                            <input 
                                type="text" 
                                [formControlName]="optIndex"
                                class="form-control" 
                                [class.is-valid]="isCorrectOption(qIndex, optIndex)"
                                placeholder="Option {{ optIndex + 1 }}">
                          </div>
                        </div>
                      }
                  </div>
  
                  <div class="mt-3">
                    <label class="form-label fw-bold text-success">Correct Answer</label>
                    <select formControlName="correctAnswer" class="form-select">
                      <option value="">Select the correct option</option>
                      @for (opt of [0,1,2,3]; track opt) {
                         <option [value]="q.get('options')?.get(opt.toString())?.value">
                            Option {{ ['A', 'B', 'C', 'D'][opt] }}
                         </option>
                      }
                    </select>
                  </div>
               </div>
              }
  
              <button type="button" class="btn btn-outline-primary mb-4" (click)="addQuestion()">
                <i class="bi bi-plus-circle me-2"></i> Add Question
              </button>
            </div>

             <!-- Actions -->
              <div class="d-flex gap-3">
                @if(isEditMode){
                  <button type="submit" class="btn btn-primary px-4 py-2" (click)="confirmAndSave()" [disabled]="newExamForm.invalid || questions.value.length === 0">
                    <i class="fa-solid fa-floppy-disk me-2"></i>
                    Edit Exam
                  </button>
                }@else{
                  <button type="submit" class="btn btn-primary px-4 py-2" (click)="confirmAndSave()" [disabled]="newExamForm.invalid || questions.value.length === 0">
                    <i class="fa-solid fa-floppy-disk me-2"></i>
                    Create Exam
                  </button>
                }
                

                
          
                <button type="button" class="btn btn-outline-secondary px-4 py-2" routerLink="/doctorDashboard/exams">
                  Cancel
                </button>
              </div>
          
            </form >




      </div>


        
    </div>




  </div>
   
    
</div>

